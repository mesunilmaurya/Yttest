<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Native Queue Demo</title>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        /* Simple Search Bar */
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; max-width: 600px; }
        input { flex: 1; padding: 10px; border-radius: 5px; border: none; background: #333; color: white; }
        button { padding: 10px 20px; background: #ff0000; color: white; border: none; border-radius: 5px; cursor: pointer; }
        
        /* Player */
        #player-container { width: 100%; max-width: 600px; aspect-ratio: 16/9; background: black; margin-bottom: 20px; }
        
        /* The Queue List */
        .queue-list { width: 100%; max-width: 600px; text-align: left; }
        .queue-item { padding: 10px; border-bottom: 1px solid #333; color: #aaa; }
        .queue-item span { color: white; font-weight: bold; }
        .note { color: #ffcc00; font-size: 14px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="search-box">
        <input type="text" id="query" placeholder="Search to load a queue (e.g., 'Music')">
        <button onclick="searchAndLoad()">Load Queue</button>
    </div>

    <div class="note">ℹ️ Look at the player controls below. The Next Icon ($>|$) works here.</div>

    <div id="player-container">
        <div id="player"></div>
    </div>

    <div class="queue-list" id="queue-display"></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        // Your API Keys
        const API_KEYS = [
            'AIzaSyAwhx-BR7rqIvSInJRKcNSECht6JHdbrbs',
            'AIzaSyCh8AnG5FrrXlxxrmqsYRZLMkI8jT3J_XY',
            'AIzaSyB66xstqYkrTnoo9ga5RlmfrynBgZ5cVbY',
            'AIzaSyDf9K1gK2yR0ELuWrB2vBJpxgzL7ox8ogQ'
        ];
        
        let player;
        let currentKeyIndex = 0;

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                playerVars: { 'autoplay': 1, 'controls': 1 }
            });
        }

        async function searchAndLoad() {
            const q = document.getElementById('query').value;
            if (!q) return alert("Please enter a search term");

            const key = API_KEYS[currentKeyIndex];
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=10&q=${q}&key=${key}`;

            try {
                const res = await fetch(url);
                const data = await res.json();
                
                if (data.error) {
                    currentKeyIndex = (currentKeyIndex + 1) % API_KEYS.length;
                    return alert("API Limit or Error. Try clicking again to switch keys.");
                }

                // 1. Extract just the Video IDs into a list
                const videoIds = data.items.map(item => item.id.videoId);

                // 2. THIS IS THE MAGIC: Load the whole list at once
                // This forces the 'Next' icon to appear natively
                player.loadPlaylist({
                    playlist: videoIds,
                    index: 0,
                    startSeconds: 0
                });

                // 3. Show the user what we loaded
                const listDiv = document.getElementById('queue-display');
                listDiv.innerHTML = "<h3>Current Queue (Inside Player):</h3>" + 
                    data.items.map((item, index) => 
                        `<div class="queue-item"><span>${index + 1}.</span> ${item.snippet.title}</div>`
                    ).join('');

            } catch (err) {
                console.error(err);
                alert("Error fetching videos");
            }
        }
    </script>
</body>
</html>
